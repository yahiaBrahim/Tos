<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>TestOS: prj/tos/tos_0.2.0/kern/memory/gdt.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.5 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>prj/tos/tos_0.2.0/kern/memory/gdt.c File Reference</h1><code>#include &quot;<a class="el" href="types_8h.html">../../kernel_components/libc/types.h</a>&quot;</code><br>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structgdtDescriptor.html">gdtDescriptor</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structgdtPointer.html">gdtPointer</a></td></tr>

<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="gdt_8c.html#19eca54f1a6ad56c9e74c075072acfe9">GDTSIZE</a>&nbsp;&nbsp;&nbsp;16</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="gdt_8c.html#771ae185d46b4d60240a97bc48e900b8">segmentType_CS</a>&nbsp;&nbsp;&nbsp;0xB</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="gdt_8c.html#643011a357bc14bdf8475714197084ec">segmentType_DS</a>&nbsp;&nbsp;&nbsp;0x3</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="gdt_8c.html#d87e302e6704e0734b011e3d959d44e1">kernelMode</a>&nbsp;&nbsp;&nbsp;0x0</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="gdt_8c.html#582816210d25470234ecdea3d4ad6405">userMode</a>&nbsp;&nbsp;&nbsp;0x3</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="gdt_8c.html#d84914d7f1892bdf51846d34a285280b">presentInMemory</a>&nbsp;&nbsp;&nbsp;0x1</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="gdt_8c.html#4225118144927ece6e478aef739ba47c">_32bitInstructions</a>&nbsp;&nbsp;&nbsp;0x1</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="gdt_8c.html#b60afe2da0876e74ceb320e3ac73ea2a">_16bitInstructions</a>&nbsp;&nbsp;&nbsp;0x0</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="gdt_8c.html#84b98663f5d3faba0d64577860b6863b">limitInBytes</a>&nbsp;&nbsp;&nbsp;0x0</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="gdt_8c.html#33cbe3c77a48be9a387bd3ef677cb34d">limitInPages</a>&nbsp;&nbsp;&nbsp;0x1</td></tr>

<tr><td colspan="2"><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef struct <a class="el" href="structgdtDescriptor.html">gdtDescriptor</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="gdt_8c.html#c7958d28630064e022c4fe096f3541c0">packed</a></td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="gdt_8c.html#59f7ac61986e37060bd14c1eb5eed9f6">GDT_init</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="gdt_8c.html#0aced86402f9ff510621bff5405d6764">GDT_set_descriptor</a> (<a class="el" href="types_8h.html#10e94b422ef0c20dcdec20d31a1f5049">u32</a> descriptor, <a class="el" href="types_8h.html#10e94b422ef0c20dcdec20d31a1f5049">u32</a> base, <a class="el" href="types_8h.html#10e94b422ef0c20dcdec20d31a1f5049">u32</a> limit, <a class="el" href="types_8h.html#ed742c436da53c1080638ce6ef7d13de">u8</a> segmentType, <a class="el" href="types_8h.html#ed742c436da53c1080638ce6ef7d13de">u8</a> segmentOrSystemCall, <a class="el" href="types_8h.html#ed742c436da53c1080638ce6ef7d13de">u8</a> ring, <a class="el" href="types_8h.html#ed742c436da53c1080638ce6ef7d13de">u8</a> presentOrSwaped, <a class="el" href="types_8h.html#ed742c436da53c1080638ce6ef7d13de">u8</a> instructionSize, <a class="el" href="types_8h.html#ed742c436da53c1080638ce6ef7d13de">u8</a> limitUnit)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="gdt_8c.html#28fbf0e0ea3ac16098b17366e8cd9633">GDT_install</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="gdt_8c.html#c6b04abea0e20e2f1cd30066c5bfc591">GDT_load_descriptor</a> (<a class="el" href="types_8h.html#10e94b422ef0c20dcdec20d31a1f5049">u32</a> descriptor)</td></tr>

<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct <a class="el" href="structgdtDescriptor.html">gdtDescriptor</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="gdt_8c.html#609c292a96ff69b70859f0611d4cf2d4">GDT</a> [GDTSIZE]</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="types_8h.html#10e94b422ef0c20dcdec20d31a1f5049">u32</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="gdt_8c.html#bba8a0a12b797b791fe3c910b1f44207">GDT_descriptors_number</a> = 0</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">struct <a class="el" href="structgdtPointer.html">gdtPointer</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="gdt_8c.html#b48d0d3b1d375bed9f339680ce9ebda9">gdtr</a></td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="b60afe2da0876e74ceb320e3ac73ea2a"></a><!-- doxytag: member="gdt.c::_16bitInstructions" ref="b60afe2da0876e74ceb320e3ac73ea2a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define _16bitInstructions&nbsp;&nbsp;&nbsp;0x0          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="4225118144927ece6e478aef739ba47c"></a><!-- doxytag: member="gdt.c::_32bitInstructions" ref="4225118144927ece6e478aef739ba47c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define _32bitInstructions&nbsp;&nbsp;&nbsp;0x1          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="19eca54f1a6ad56c9e74c075072acfe9"></a><!-- doxytag: member="gdt.c::GDTSIZE" ref="19eca54f1a6ad56c9e74c075072acfe9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define GDTSIZE&nbsp;&nbsp;&nbsp;16          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="d87e302e6704e0734b011e3d959d44e1"></a><!-- doxytag: member="gdt.c::kernelMode" ref="d87e302e6704e0734b011e3d959d44e1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define kernelMode&nbsp;&nbsp;&nbsp;0x0          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="84b98663f5d3faba0d64577860b6863b"></a><!-- doxytag: member="gdt.c::limitInBytes" ref="84b98663f5d3faba0d64577860b6863b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define limitInBytes&nbsp;&nbsp;&nbsp;0x0          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="33cbe3c77a48be9a387bd3ef677cb34d"></a><!-- doxytag: member="gdt.c::limitInPages" ref="33cbe3c77a48be9a387bd3ef677cb34d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define limitInPages&nbsp;&nbsp;&nbsp;0x1          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="d84914d7f1892bdf51846d34a285280b"></a><!-- doxytag: member="gdt.c::presentInMemory" ref="d84914d7f1892bdf51846d34a285280b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define presentInMemory&nbsp;&nbsp;&nbsp;0x1          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="771ae185d46b4d60240a97bc48e900b8"></a><!-- doxytag: member="gdt.c::segmentType_CS" ref="771ae185d46b4d60240a97bc48e900b8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define segmentType_CS&nbsp;&nbsp;&nbsp;0xB          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
the folowing are used to indicate the type of segment, we use afrendly names instead of using binary parameters they are used as parameters of the function GDT_set_descriptor(.....) 
</div>
</div><p>
<a class="anchor" name="643011a357bc14bdf8475714197084ec"></a><!-- doxytag: member="gdt.c::segmentType_DS" ref="643011a357bc14bdf8475714197084ec" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define segmentType_DS&nbsp;&nbsp;&nbsp;0x3          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="582816210d25470234ecdea3d4ad6405"></a><!-- doxytag: member="gdt.c::userMode" ref="582816210d25470234ecdea3d4ad6405" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define userMode&nbsp;&nbsp;&nbsp;0x3          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="c7958d28630064e022c4fe096f3541c0"></a><!-- doxytag: member="gdt.c::packed" ref="c7958d28630064e022c4fe096f3541c0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structgdtPointer.html">gdtPointer</a> <a class="el" href="structchunk.html">packed</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="59f7ac61986e37060bd14c1eb5eed9f6"></a><!-- doxytag: member="gdt.c::GDT_init" ref="59f7ac61986e37060bd14c1eb5eed9f6" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void GDT_init           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
GDT_init : initialize the gdt table : insert the code and data segment and copy the gdt to a new place 
</div>
</div><p>
<a class="anchor" name="28fbf0e0ea3ac16098b17366e8cd9633"></a><!-- doxytag: member="gdt.c::GDT_install" ref="28fbf0e0ea3ac16098b17366e8cd9633" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void GDT_install           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
GDT_install : load the new GDT to the gdtr register, that means 
</div>
</div><p>
<a class="anchor" name="c6b04abea0e20e2f1cd30066c5bfc591"></a><!-- doxytag: member="gdt.c::GDT_load_descriptor" ref="c6b04abea0e20e2f1cd30066c5bfc591" args="(u32 descriptor)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void GDT_load_descriptor           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="types_8h.html#10e94b422ef0c20dcdec20d31a1f5049">u32</a>&nbsp;</td>
          <td class="paramname"> <em>descriptor</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
GDT_install : load the new GDT to the gdtr register, that means 
</div>
</div><p>
<a class="anchor" name="0aced86402f9ff510621bff5405d6764"></a><!-- doxytag: member="gdt.c::GDT_set_descriptor" ref="0aced86402f9ff510621bff5405d6764" args="(u32 descriptor, u32 base, u32 limit, u8 segmentType, u8 segmentOrSystemCall, u8 ring, u8 presentOrSwaped, u8 instructionSize, u8 limitUnit)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void GDT_set_descriptor           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="types_8h.html#10e94b422ef0c20dcdec20d31a1f5049">u32</a>&nbsp;</td>
          <td class="paramname"> <em>descriptor</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="types_8h.html#10e94b422ef0c20dcdec20d31a1f5049">u32</a>&nbsp;</td>
          <td class="paramname"> <em>base</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="types_8h.html#10e94b422ef0c20dcdec20d31a1f5049">u32</a>&nbsp;</td>
          <td class="paramname"> <em>limit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="types_8h.html#ed742c436da53c1080638ce6ef7d13de">u8</a>&nbsp;</td>
          <td class="paramname"> <em>segmentType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="types_8h.html#ed742c436da53c1080638ce6ef7d13de">u8</a>&nbsp;</td>
          <td class="paramname"> <em>segmentOrSystemCall</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="types_8h.html#ed742c436da53c1080638ce6ef7d13de">u8</a>&nbsp;</td>
          <td class="paramname"> <em>ring</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="types_8h.html#ed742c436da53c1080638ce6ef7d13de">u8</a>&nbsp;</td>
          <td class="paramname"> <em>presentOrSwaped</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="types_8h.html#ed742c436da53c1080638ce6ef7d13de">u8</a>&nbsp;</td>
          <td class="paramname"> <em>instructionSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="types_8h.html#ed742c436da53c1080638ce6ef7d13de">u8</a>&nbsp;</td>
          <td class="paramname"> <em>limitUnit</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
GDT_set_descriptor : set a GDT descriptor, u32 descriptor : witch descriptor to set (the descriptor 0 is not used),1 means the first descriptor u8 segmentType : 4; //data segment or code segment or stack segment u8 segmentOrSystemCall :1;//to revise the name of this after you know what it does u8 Ring:2; //ring0 is kernel segment and ring=3 for user mode segment,this used for protection u8 presentOrSwaped:1; //to indicate if the segment is present in memory or it has been swaped to the HDD u8 segmentLimit_16_19:4; u8 NotUsed:2; //this 2 bits feild is not used , so just put it to 0 u8 instructionSize:1; //instructionSize=1 for 32bit instructions u8 limitUnit:1; //0 if the limit is expressed in bytes or 1 if the limit is in pages u32 segmentBase : adresse of the beginnig of the segment u32 limit :size of the descriptor, if limitUnit=limitInBytes so this limit is expressed in byte not in pages 
</div>
</div><p>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="609c292a96ff69b70859f0611d4cf2d4"></a><!-- doxytag: member="gdt.c::GDT" ref="609c292a96ff69b70859f0611d4cf2d4" args="[GDTSIZE]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structgdtDescriptor.html">gdtDescriptor</a> <a class="el" href="gdt_8c.html#609c292a96ff69b70859f0611d4cf2d4">GDT</a>[GDTSIZE]          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="bba8a0a12b797b791fe3c910b1f44207"></a><!-- doxytag: member="gdt.c::GDT_descriptors_number" ref="bba8a0a12b797b791fe3c910b1f44207" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="types_8h.html#10e94b422ef0c20dcdec20d31a1f5049">u32</a> <a class="el" href="gdt_8c.html#bba8a0a12b797b791fe3c910b1f44207">GDT_descriptors_number</a> = 0          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="b48d0d3b1d375bed9f339680ce9ebda9"></a><!-- doxytag: member="gdt.c::gdtr" ref="b48d0d3b1d375bed9f339680ce9ebda9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structgdtPointer.html">gdtPointer</a> <a class="el" href="gdt_8c.html#b48d0d3b1d375bed9f339680ce9ebda9">gdtr</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Thu Oct 9 21:00:49 2008 for TestOS by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.5 </small></address>
</body>
</html>
